<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../static/lib/bootstrap/css/bootstrap.min.css" th:href="@{/lib/bootstrap/css/bootstrap.min.css}">
    <link rel="stylesheet" href="../static/lib/animate/animate.css" th:href="@{/lib/animate/animate.css}">
    <link rel="stylesheet" href="../static/lib/fontawesome/css/font-awesome.css" th:href="@{/lib/fontawesome/css/font-awesome.min.css}">
    <link rel="stylesheet" href="../static/lib/highlight/agate.min.css" th:href="@{/lib/highlight/agate.min.css}">
    <link rel="stylesheet" href="../static/lib/bootstrap/css/bootstrap.rtl.css" th:href="@{/lib/bootstrap/css/bootstrap.rtl.css}">
    <link rel="stylesheet" href="../static/css/download-page.css" th:href="@{/css/download-page.css}">
    <link rel="stylesheet" href="../static/css/me.css" th:href="@{/css/me.css}">
    <link rel="stylesheet" href="../static/css/gallery-page.css" th:href="@{/css/gallery-page.css}">
    <link rel="stylesheet" href="../static/css/wiki-page.css" th:href="@{/css/wiki-page.css}">
    <title>下载</title>
</head>
<body th:style="'background-image: url('+@{/images/klee1.png}+');'">

    <nav class="navbar navbar-dark py-sm-1 fixed-top" id="nav_bar">
        <div class="container-lg row h-100">
            <a class="navbar-brand col-3 h-100" href="./" th:href="@{/}">
                <img src="../static/images/kuayue_logo.png" th:src="@{/images/kuayue_logo.png}" alt="logo" class="w-25">
                <span class="nav_bar_button"><strong>跨越</strong>&nbsp;|&nbsp;Kuayue</span>
            </a>
            <div class="col-1 h-100 no_padding no_border no_background_color nav_bar_button">
                <a href="./download.html" th:href="@{/download}" class="no_text_decoration"><span class="nav_bar_button">下载</span></a>
            </div>
            <div class="col-1 h-100 no_padding no_border no_background_color nav_bar_button">
                <a href="./gallery.html" th:href="@{/gallery}" class="no_text_decoration"><span class="nav_bar_button">画廊</span></a>
            </div>
            <div class="col-1 h-100 no_padding no_border no_background_color nav_bar_button">
                <a href="./wiki.html" th:href="@{/wiki}" class="no_text_decoration"><span class="nav_bar_button">百科</span></a>
            </div>
            <div class="col-1 h-100 no_padding no_border no_background_color nav_bar_button">
                <a href="./schematic.html" th:href="@{/schematic}" class="no_text_decoration"><span class="nav_bar_button">蓝图</span></a>
            </div>
            <div class="col-1 h-100 no_padding no_border no_background_color nav_bar_button">
                <a href="./bbs_entrance.html" th:href="@{/bbs_entrance}" class="no_text_decoration"><span class="nav_bar_button">论坛</span></a>
            </div>

            <div class="col-3 h-100 no_padding no_border no_background_color">
                <div style="float: right">
                    <a class="nav_bar_button" href="login.html" th:if="${session.user}==null" th:href="@{/login}"><strong>登录</strong></a>
                    <span class="nav_bar_button" th:if="${session.user}==null">|</span>
                    <a class="nav_bar_button" href="login.html" th:if="${session.user}==null" th:href="@{/signUp}"><strong>注册</strong></a>
                    <div th:if="${session.user}!=null" class="dropdown">
                        <a class="nav_bar_button dropdown-toggle" data-bs-toggle="dropdown" href="#">
                            <img src="../static/images/avatar/ayaka1.png" th:src="@{${session.user.avatar}}" style="max-width: 30px">
                            <span th:text="${session.user.nickname}">用户昵称</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="#" th:href="@{/admin/user}" class="dropdown-item">个人主页</a></li>
                            <li><a href="#" th:href="@{/admin/logout}" class="dropdown-item">退出登录</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div id="waypoint" class="container-sm animate__animated animate__fadeIn" style="margin-top: 10em; margin-bottom: 10em">
        <div class="row">
            <div class="col-10 bg-light" style="border-radius: 10px">
                <div>
                    <h1 style="margin-top: 0.5em; margin-left: 0.2em" class="m-xiaokai">文件列表</h1>
                </div>
                <hr>
                <table class="table table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>运行环境</th>
                            <th>MOD文件名</th>
                            <th>MC版本</th>
                            <th>下载量</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="file : ${allModFiles}">
                            <td th:text="${file.id}">114</td>
                            <td th:text="${file.env}">forge</td>
                            <td th:text="${file.modFileName}">kuayue-0.3.5m-izayoi_sakuya-rc2.jar</td>
                            <td th:text="${file.MCVersion}">1.20.1</td>
                            <td th:text="${file.downloadCounts}">776</td>
                            <td>
                                <a href="javascript:;" class="download_button" style="text-decoration: none"
                                   data-bs-toggle="modal" data-bs-target="#downloadModal"
                                   th:data-bs-id="${file.id}" data-bs-id="download-mod-id"
                                   th:data-bs-name="${file.modFileName}" data-bs-name="download-mod-name"
                                   th:data-bs-env="${file.env}" data-bs-env="forge"
                                   th:data-bs-version="${file.MCVersion}" data-bs-version="1.19.2">下载</a>
                            </td>
                        </tr>
                        <!--/*-->
                        <tr>
                            <td>114</td>
                            <td>forge</td>
                            <td>kuayue-0.3.5m-izayoi_sakuya-rc2.jar</td>
                            <td>1.20.1</td>
                            <td>776</td>
                            <td>
                                <a href="#" class="download_button" style="text-decoration: none">下载</a>
                            </td>
                        </tr>
                        <!--*/-->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!--    MOD文件下载模态弹窗-->
    <div class="modal fade" id="downloadModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">下载MOD文件</h5>
                    <img src="../static/images/hxd3d.png" th:src="@{/images/hxd3d.png}" alt="" style="max-height: 30px">
                </div>
                <form class="modal-body" th:action="@{/modDownload}" method="post">
                    <input type="hidden" class="form-control" id="download-mod-id" name="id">
                    <div class="mb-3">
                        <label for="download-mod-name" class="col-form-label">您要下载的MOD</label>
                        <input type="text" class="form-control" id="download-mod-name" disabled>
                    </div>
                    <div class="mb-3 row">
                        <div class="col-6">
                            <label for="download-mod-env" class="col-form-label">运行环境</label>
                            <input type="text" class="form-control" id="download-mod-env" disabled>
                        </div>
                        <div class="col-6">
                            <label for="download-mod-version" class="col-form-label">MC版本</label>
                            <input type="text" class="form-control" id="download-mod-version" disabled>
                        </div>
                    </div>
                    <div class="mb-5">
                        <label for="download-mod-code" class="col-form-label">验证码</label>
                        <div class="input-group">
                            <input type="text" placeholder="请输入验证码" autocomplete="off" name="modDownloadCode"
                                   id="download-mod-code" class="form-control" required>
                            <img id="codeImage" class="input-group-text" th:src="@{/getModDownloadCode}" onclick="changeDownloadCode()">
                        </div>
                        <div id="modDownloadCodeInfo" class="m-xiaokai" style="font-size: small"></div>
                    </div>
                    <div style="float: right">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button id="confirmDownload" type="submit" class="btn btn-primary"
                                data-bs-target="#modal2" data-bs-toggle="modal" data-bs-dismiss="modal" disabled>确认下载</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- 开始下载提示框 -->
    <div class="modal fade" id="modal2" aria-hidden="true" aria-labelledby="..." tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title col-11">
                        <img src="../static/images/hxd3d.png" th:src="@{/images/hxd3d.png}" alt="" style="max-height: 30px">
                        &nbsp;Kuayue
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" style="text-align: center">
                    <h4>开始下载...</h4>
                </div>
            </div>
        </div>
    </div>

    <footer></footer>

    <div id="toolbar" class="m-padded-tool m-fixed m-right-bottom" style="display: none">
        <div type="button" class="btn btn-lg btn-secondary" id="to-top-btn"
             data-bs-toggle="popover" data-bs-trigger="hover" data-bs-content="返回顶部">
            <i class="fa fa-angle-up" style="font-size: 30px"></i>
        </div>
    </div>

    <div class="fixed-bottom row bottom_bar wiki_bottom_bar" id="bottom_bar">
        <div class="col align_left">
            <a class="color_939393" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=45128102451361">桂公网安备 45128102451361号</a> <br />
            <a class="color_939393" href="https://beian.miit.gov.cn/">桂ICP备2022002550号</a>
        </div>
        <div class="col color_939393 align_right">
            Kuayue&nbsp;Development&nbsp;Group&nbsp;&nbsp;2023<br/>
            跨越开发组&nbsp;&nbsp;2023
        </div>
    </div>

    <script src="../static/lib/jquery/jquery-3.7.1.js" th:src="@{/lib/jquery/jquery-3.7.1.js}"></script>
    <script src="../static/lib/bootstrap/js/bootstrap.bundle.min.js" th:src="@{/lib/bootstrap/js/bootstrap.bundle.min.js}"></script>
    <script src="../static/lib/highlight/highlight.min.js" th:src="@{/lib/highlight/highlight.min.js}"></script>
    <script src="../static/lib/waypoints/jquery.waypoints.min.js" th:src="@{/lib/waypoints/jquery.waypoints.min.js}"></script>
    <script src="../static/js/home_page.js" th:src="@{/js/home_page.js}"></script>
    <script src="../static/js/download_page.js" th:src="@{/js/download_page.js}"></script>

    <script>
        <!--返回顶部-->
        $('#to-top-btn').click(function toTop() {
            $('html').animate({scrollTop: 0}, 300);
        });

        let popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
        let popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
            return new bootstrap.Popover(popoverTriggerEl);
        });

        <!--滚动侦测-->
        let waypoint = new Waypoint({
            element: document.getElementById('waypoint'),
            handler: function(direction){
                if (direction == 'down'){
                    $('#toolbar').show(100); //100毫秒
                }else{
                    $('#toolbar').hide(300);
                }
                console.log('Scrolled to waypoint!');
            }
        });
    </script>

</body>
    <style>
        th, td {
            max-width: 500px; /* 设置每列的最大宽度为500像素 */
            overflow: hidden; /* 当内容超过指定宽度时隐藏部分内容 */
            text-overflow: ellipsis; /* 显示省略号(...)来表示被隐藏的文本 */
            white-space: nowrap; /* 不换行 */
        }
    </style>
</html>
